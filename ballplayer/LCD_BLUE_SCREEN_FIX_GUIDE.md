# ballplayer项目LCD深蓝色显示问题解决方案

## 问题描述
- LCD显示深蓝色，无法显示预期的白色背景
- LED3和LED5常亮不闪烁

## 解决方案

### 1. 引脚配置修正
✅ **已完成** - 根据用户提供的引脚文档重新配置所有引脚：
- LCD SPI引脚：RST(P15), DC(R14), SCLK(R11), MOSI(P12), CS(R9), BLK(D7)
- LED引脚：使用开发板的8个实际LED引脚 (N15, N14, M14, M12, L15, K12, L11, K11)
- 其他外设引脚按文档配置

### 2. LCD初始化改进
✅ **已完成** - 创建了完整的ST7789V初始化序列：
- 更长的复位时间
- 正确的像素格式设置（RGB565）
- 完整的显示窗口配置
- 内存访问控制设置
- 显示反转和正常模式配置

### 3. LED状态指示优化
✅ **已完成** - 现在有8个LED指示不同状态：
- **LED0 (PIN_N15)**: LCD工作状态
- **LED1 (PIN_N14)**: LCD初始化完成
- **LED2 (PIN_M14)**: 传感器数据有效
- **LED3 (PIN_M12)**: 手势检测
- **LED4 (PIN_L15)**: ADC采样完成
- **LED5 (PIN_K12)**: 游戏结束标志
- **LED6 (PIN_L11)**: 游戏停止标志
- **LED7 (PIN_K11)**: 预留

## 编译和测试步骤

### 第一步：编译项目
1. 在Quartus Prime中打开 `ballplayer.qpf`
2. 验证器件设置为 `10M08SAM153C8G`
3. 检查引脚分配是否正确
4. 进行完整编译

### 第二步：观察LED状态
编译并下载到FPGA后，观察LED行为：

**正常工作预期：**
- LED0: 应该在系统运行后亮起（LCD工作状态）
- LED1: 应该在LCD初始化完成后亮起（约几秒后）
- LED2-LED7: 根据功能模块状态变化

**如果LED3和LED5仍然常亮不变：**
- 可能是传感器或ADC模块卡住
- 检查I2C和ADC引脚连接

### 第三步：LCD显示测试
**预期结果：**
- LCD应该显示白色背景，而不是深蓝色
- 背光应该正常点亮

**如果仍显示深蓝色：**
1. 检查LCD控制器类型是否为ST7789V
2. 验证SPI引脚连接（特别是MOSI和SCLK）
3. 检查LCD电源电压（应该是3.3V）
4. 确认LCD复位引脚工作正常

## 可能的硬件问题排查

### LCD硬件检查
1. **电源检查**：
   - 确认LCD VDD = 3.3V
   - 确认背光电源正常
   
2. **SPI连接检查**：
   - SCLK (PIN_R11) → LCD SCLK
   - MOSI (PIN_P12) → LCD SDA/MOSI
   - CS (PIN_R9) → LCD CS
   - DC (PIN_R14) → LCD DC
   - RST (PIN_P15) → LCD RST

3. **信号测试**：
   - 用示波器检查SCLK是否有时钟信号
   - 检查MOSI是否有数据传输
   - 验证CS和DC信号变化

### 传感器和ADC检查
1. **I2C传感器**：
   - SCL (PIN_M4) 和 SDA (PIN_P3) 连接
   - 检查上拉电阻（通常需要4.7kΩ）
   
2. **ADC连接**：
   - CS (PIN_B7), CLK (PIN_B8), DAT (PIN_C8)

## 新增文件列表
- `lcd_full_init_test.v` - 完整的LCD初始化测试模块
- `PIN_CONFIGURATION_SUMMARY.md` - 引脚配置总结

## 下一步调试建议

如果上述步骤完成后问题仍然存在：

1. **使用SignalTap调试**：
   - 监控LCD SPI信号
   - 检查状态机执行流程
   
2. **简化测试**：
   - 暂时禁用传感器和ADC模块
   - 只测试LCD显示功能
   
3. **硬件替换测试**：
   - 尝试其他已知工作的LCD模块
   - 验证FPGA开发板功能

## 关键修改总结
1. ✅ 引脚配置完全基于用户提供的文档
2. ✅ LCD初始化序列按ST7789V规范实现
3. ✅ LED状态指示优化为8路独立指示
4. ✅ 添加了详细的调试文档和排查步骤

现在您可以在Quartus Prime中编译项目，观察LED状态，并根据上述指南进行硬件调试。

# Advanced Electric Piano - 高级电子琴系统

基于示例代码改进的高级电子琴，支持矩阵键盘手动演奏和多首歌曲自动播放功能。

## 🎵 功能特性

### 五种工作模式
1. **手动演奏模式** (000) - 矩阵键盘实时演奏
2. **《稻香》播放** (001) - 周杰伦经典歌曲自动播放
3. **《青花瓷》播放** (010) - 中国风代表作自动播放  
4. **《告白气球》播放** (011) - 流行情歌自动播放
5. **《简单爱》播放** (100) - 经典抒情歌曲自动播放

### 硬件支持
- **FPGA平台**: MAX 10 (10M08SAM153C8G)
- **系统时钟**: 12MHz
- **输入设备**: 4x4 矩阵键盘
- **音频输出**: PWM驱动蜂鸣器
- **状态显示**: 8位LED显示 + 4位模式指示灯

## 🎹 按键布局

```
矩阵键盘 4x4 布局:
[1] [2] [3] [A]  <- 第1行: Do Re Mi + 模式1
[4] [5] [6] [B]  <- 第2行: Fa So La + 模式2  
[7] [8] [9] [C]  <- 第3行: Si Do♯ Re♯ + 模式3
[*] [0] [#] [D]  <- 第4行: 其他音符 + 模式4
```

### 手动演奏音符对应
- **1**: Do (C4) - 261.6Hz
- **2**: Re (D4) - 293.7Hz  
- **3**: Mi (E4) - 329.6Hz
- **4**: Fa (F4) - 349.2Hz
- **5**: So (G4) - 392.0Hz
- **6**: La (A4) - 440.0Hz
- **7**: Si (B4) - 493.9Hz
- **8**: Do♯ (C5) - 523.3Hz (高八度)
- **9**: Re♯ (D5) - 587.3Hz
- **0**: Mi♯ (E5) - 659.3Hz  
- **#**: Fa♯ (F5) - 698.5Hz
- *****: So♯ (G5) - 784.0Hz

### 模式切换按键
- **A**: 切换到《稻香》自动播放模式
- **B**: 切换到《青花瓷》自动播放模式
- **C**: 切换到《告白气球》自动播放模式  
- **D**: 切换到《简单爱》自动播放模式

## 🔧 系统架构

### 核心模块
1. **Advanced_Electric_Piano.v** - 顶层模块
2. **Mode_Controller.v** - 模式控制器
3. **Music_Player.v** - 音乐播放器
4. **Advanced_Beeper.v** - 高级蜂鸣器控制
5. **Array_KeyBoard.v** - 矩阵键盘驱动
6. **PWM.v** - PWM信号生成
7. **tone.v** - 音调频率转换

### 信号流程
```
矩阵键盘 → 按键检测 → 模式控制器 → 音乐播放器/手动演奏
                                        ↓
蜂鸣器 ← PWM生成器 ← 音调转换器 ← 高级蜂鸣器控制
```

## 📋 引脚分配

### 时钟和复位
- **clk**: J5 (12MHz系统时钟)
- **rst_n**: J14 (复位信号，低电平有效)

### 矩阵键盘
- **col[3:0]**: P4, L7, R5, P6 (列输出)
- **row[3:0]**: P9, P8, P7, R7 (行输入)

### 音频输出  
- **beeper**: B14 (蜂鸣器PWM输出)

### 状态显示
- **led_display[7:0]**: N15, N14, M14, M12, L15, K12, L11, K11 (8位LED模式显示)
- **mode_indicator[3:0]**: J12, H11, H12, H13 (4位模式指示灯，复用按键引脚)

## 🚀 使用方法

### 1. 项目编译
1. 在 Quartus Prime 中打开 `Electric_Piano.qpf`
2. 确认顶层实体设为 `Advanced_Electric_Piano`
3. 运行 Analysis & Synthesis 检查语法
4. 运行 Fitter 进行布局布线
5. 生成 .sof 文件进行下载

### 2. 硬件连接
1. 连接4x4矩阵键盘到指定引脚
2. 连接蜂鸣器到B14引脚
3. 连接LED显示模块
4. 连接12MHz晶振到J5引脚

### 3. 操作说明
1. **上电复位**: 系统默认进入手动演奏模式
2. **手动演奏**: 按数字键发出对应音符
3. **切换模式**: 按A/B/C/D键切换到对应自动播放模式
4. **观察状态**: 通过LED显示和模式指示灯确认当前模式

## 🎼 歌曲信息

### 《稻香》(模式001)
- **演唱者**: 周杰伦
- **音符数量**: 32个
- **播放速度**: 2拍/秒
- **主旋律**: So-La-Do(高)-La-So-Fa-Mi-Re-Do...

### 《青花瓷》(模式010)  
- **演唱者**: 周杰伦
- **音符数量**: 28个
- **风格**: 中国风
- **主旋律**: Do-Re-Mi-So-La-So-Mi-Re-Do...

### 《告白气球》(模式011)
- **演唱者**: 周杰伦  
- **音符数量**: 24个
- **风格**: 流行抒情
- **主旋律**: Do-Re-Mi-Fa-So-La-So-Fa-Mi...

### 《简单爱》(模式100)
- **演唱者**: 周杰伦
- **音符数量**: 20个  
- **风格**: 经典抒情
- **主旋律**: Mi-Fa-So-La-So-Fa-Mi-Re-Do...

## ⚙️ 技术参数

- **FPGA资源使用**: 约500个逻辑单元
- **内存使用**: 约2KB RAM用于音符存储
- **时钟频率**: 12MHz主时钟
- **音频分辨率**: 16位PWM输出
- **按键防抖**: 硬件防抖动处理
- **响应延迟**: <10ms按键响应

## 🔍 故障排除

### 常见问题
1. **无声音输出**: 检查蜂鸣器连接和PWM设置
2. **按键无响应**: 确认矩阵键盘连接正确
3. **模式无法切换**: 检查模式切换按键A/B/C/D
4. **LED不亮**: 验证LED显示引脚连接

### 调试方法
1. 使用测试平台 `Advanced_Electric_Piano_tb.v` 进行仿真
2. 通过SignalTap观察内部信号
3. 检查引脚分配是否与硬件匹配

## 📝 更新日志

### v2.0 (当前版本)
- ✅ 新增4种自动播放模式
- ✅ 实现模式切换控制器
- ✅ 添加LED状态显示
- ✅ 优化音频PWM输出
- ✅ 支持防抖动按键检测

### v1.0 (基础版本)
- ✅ 基础矩阵键盘手动演奏功能
- ✅ PWM蜂鸣器驱动
- ✅ 音调频率转换

## 👥 开发团队

基于原始示例代码改进开发，实现了更高级的电子琴功能，支持周杰伦多首经典歌曲的自动播放。

---
**注意**: 本项目仅用于学习和研究目的，歌曲旋律为简化版本。
